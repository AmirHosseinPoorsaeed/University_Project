{% extends '_base.html' %}
{% load static %}

{% block custom_style %}
    <link rel="stylesheet" href="{% static 'css/product_style.css' %}">
{% endblock %}

{% block page_title %}
    Products
{% endblock %}

{% block content %}
    <header>
        <div class="logo">
            <h2>Logo</h2>
        </div>
        <div class="user-auth">
            <div class="auth-link" id="authButton">
                <span>Login/Sign in</span>
            </div>
            <div class="user-profile" id="userProfile" style="display: none;">
                <i class="fas fa-user-circle"></i>
                <span class="profile-text">Profile</span>
            </div>
        </div>
        <nav>
            <ul>
                <li><a href="#" >Home</a></li>
                <li><a href="#" class="active">Products</a></li>
                <li><a href="#">cart</a></li>
                <li><a href="#">Gallery</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Contact us</a></li>
            </ul>
            </ul>
        </nav>
    </header>

    <section class="hero">
        <div class="text-container">
            <h1>SPORTS<br><span>SHOES</span></h1>
            <p>
                {{ product.description|linebreaks }}
            </p>
            
            <p>Price: <span id="product-price">{{ product.variants.first.price }}</span></p>

            <div class="size-options">
                {% for variant in product.variants.all %}
                    <button class="size-selector" data-price="{{ variant.price }}" data-size="{{ variant.size }}">
                        {{ variant.size }}
                    </button>
                {% endfor %}
            </div>

            <button id="add-to-cart-btn" data-product-id="{{ product.id }}" data-size="{{ product.variants.first.size }}" data-price="{{ product.variants.first.price }}">
                Shop
            </button>
        </div>

        <div class="image-container">
            <img src="{% static 'images/1.png' %}" alt="Shoe" class="shoe-image">
            <div class="product-icons">
                <div class="icon active" data-shoe="1"><img src="{% static 'images/1.png' %}" alt="Shoe 1"></div>
                <div class="icon" data-shoe="2"><img src="{% static 'images/2.png' %}" alt="Shoe 2"></div>
                <div class="icon" data-shoe="3"><img src="{% static 'images/3.png' %}" alt="Shoe 3"></div>
                <div class="icon" data-shoe="4"><img src="{% static 'images/4.png' %}" alt="Shoe 4"></div>
            </div>
        </div>
        
        <a href="#" class="more-button">
            <span>More</span>
            <div class="arrow"></div>
        </a>
    </section>

    <div class="carousel-container">
        <button class="nav-arrow left">‹</button>
        <div class="carousel-track">
            <div class="card" data-index="0">
                <img src="{% static 'images/1.1.png' %}" alt="Image 1" class="carousel-image">
            </div>
            <div class="card" data-index="1">
                <img src="{% static 'images/1.2.png' %}" alt="Image 2" class="carousel-image">
            </div>
            <div class="card" data-index="2">
                <img src="{% static 'images/1.3.png' %}" alt="Image 3" class="carousel-image">
            </div>
            <div class="card" data-index="3">
                <img src="{% static 'images/1.4.png' %}" alt="Image 4" class="carousel-image">
            </div>
        </div>
        <button class="nav-arrow right">›</button>
    </div>

    <div class="dots">
        <div class="dot active" data-index="0"></div>
        <div class="dot" data-index="1"></div>
        <div class="dot" data-index="2"></div>
        <div class="dot" data-index="3"></div>
    </div>

     <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#">Products</a></li>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Call with us</h3>
                <p>Email: benyaminm.p.h@gmail.com</p>
                <p>Phone: (+98) 9367377088</p>
                <p>Telegram: @iambeniph</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 SportsShoes. All rights reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const priceDisplay = document.getElementById('product-price');
            const sizeSelectors = document.querySelectorAll('.size-selector');
            const addToCartBtn = document.getElementById('add-to-cart-btn');

            sizeSelectors.forEach(button => {
                button.addEventListener('click', function() {
                    // Get the price and size from the data attributes
                    const newPrice = this.getAttribute('data-price');
                    const newSize = this.getAttribute('data-size');
                    
                    // Update the price display
                    priceDisplay.textContent = newPrice;
                    
                    // Update the data attributes of the "Shop" button
                    addToCartBtn.setAttribute('data-size', newSize);
                    addToCartBtn.setAttribute('data-price', newPrice);
                });
            });
            
            // Add a click listener to the "Shop" button
            addToCartBtn.addEventListener('click', function() {
                // Get the data from the button's data attributes
                const productIdStr = this.getAttribute('data-product-id');
                const selectedSizeStr = this.getAttribute('data-size');
                const selectedPriceStr = this.getAttribute('data-price');

                const selectedPrice = parseFloat(selectedPriceStr);
                 
                // Send this data to the backend
                // For this example, we'll use a simple fetch POST request
                fetch('/cart/add/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // CSRF token is crucial for security in Django
                        'X-CSRFToken': '{{ csrf_token }}' 
                    },
                    body: JSON.stringify({
                        'product_id': productIdStr,
                        'size': selectedSizeStr,
                        'price': selectedPrice
                    })
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    alert('Product added to cart!');
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            });
        });
    </script>
{% endblock %}

{% block custom_js %}
    <script src="{% static 'js/product_script.js' %}"></script>
{% endblock %}